import React, { useState, useRef } from 'react';
import { Button } from '@/components/ui/button';
import { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';
import { CascadingAreaFilter, CascadingAreaFilterRef } from '@/components/CustomerFeedback/CascadingAreaFilter';
import { TimeFilter, TimeFilterValue, TimeFilterRef } from '@/components/CustomerFeedback/TimeFilter';
import { CategoryFilter, CategoryFilterRef } from '@/components/CustomerFeedback/CategoryFilter';
import { ServiceTypeFilter, ServiceTypeFilterRef } from '@/components/CustomerFeedback/ServiceTypeFilter';
import { RegionalSentimentChart } from '@/components/Dashboard/RegionalSentimentChart';
import { SentimentTrendsChart } from '@/components/Dashboard/SentimentTrendsChart';
import { MentionedCategoriesTable } from '@/components/Dashboard/MentionedCategoriesTable';
export default function RegionalPerformance() {
  const [selectedArea, setSelectedArea] = useState<{
    division?: number | 'all';
    region?: number | 'all';
    zone?: string | 'all';
    branch?: string | 'all';
  }>({
    division: 'all',
    region: 'all',
    zone: 'all',
    branch: 'all'
  });
  const [selectedCategories, setSelectedCategories] = useState<string[]>([]);
  const [selectedServiceTypes, setSelectedServiceTypes] = useState<string[]>([]);
  const [timeFilter, setTimeFilter] = useState<TimeFilterValue>({
    type: 'all'
  });
  const categoryFilterRef = useRef<CategoryFilterRef>(null);
  const cascadingAreaFilterRef = useRef<CascadingAreaFilterRef>(null);
  const timeFilterRef = useRef<TimeFilterRef>(null);
  const serviceTypeFilterRef = useRef<ServiceTypeFilterRef>(null);

  const handleClearAllFilters = () => {
    if (categoryFilterRef.current) {
      categoryFilterRef.current.selectAll();
    }
    if (cascadingAreaFilterRef.current) {
      cascadingAreaFilterRef.current.selectAll();
    }
    if (timeFilterRef.current) {
      timeFilterRef.current.selectAll();
    }
    if (serviceTypeFilterRef.current) {
      serviceTypeFilterRef.current.selectAll();
    }
  };
  const hasAnyFilters = selectedArea.division && selectedArea.division !== 'all' || selectedArea.region && selectedArea.region !== 'all' || selectedArea.zone && selectedArea.zone !== 'all' || selectedArea.branch && selectedArea.branch !== 'all' || selectedCategories.length > 0 || selectedServiceTypes.length > 0 || timeFilter.type !== 'all';
  return <div className="w-full p-4 md:p-6 lg:pl-2 lg:pr-4 xl:pl-3 xl:pr-6">
      <div className="mb-4 md:mb-6">
        <div className="flex justify-between items-start">
          <div>
            <h1 className="text-2xl md:text-3xl font-bold text-foreground mb-2">
              ‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏á‡∏≤‡∏ô‡∏£‡∏≤‡∏¢‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà
            </h1>
            <p className="text-sm md:text-base text-muted-foreground">
              ‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡πÅ‡∏ô‡∏ß‡πÇ‡∏ô‡πâ‡∏°‡∏Å‡∏≤‡∏£‡πÉ‡∏´‡πâ‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£ ‡∏®‡∏±‡∏Å‡∏¢‡∏†‡∏≤‡∏û ‡πÅ‡∏•‡∏∞‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏Ç‡∏≠‡∏á‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤‡πÉ‡∏ô‡πÅ‡∏ï‡πà‡∏•‡∏∞‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà
            </p>
          </div>
          {hasAnyFilters && <Button type="button" variant="outline" onClick={handleClearAllFilters}>
              ‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï‡∏ï‡∏±‡∏ß‡∏Å‡∏£‡∏≠‡∏á
            </Button>}
        </div>
      </div>
      
      <div className="space-y-4">
        {/* ‡∏Å‡∏≤‡∏£‡∏Å‡∏£‡∏≠‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• Container */}
        <Card>
          <CardHeader className="pb-3">
            <CardTitle className="text-lg">‡∏Å‡∏≤‡∏£‡∏Å‡∏£‡∏≠‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</CardTitle>
          </CardHeader>
          <CardContent>
            <div className="grid gap-4 grid-cols-1 md:grid-cols-2 lg:grid-cols-2 xl:grid-cols-2 items-stretch">
              {/* ‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà */}
              <div className="h-full">
                <CascadingAreaFilter ref={cascadingAreaFilterRef} selectedArea={selectedArea} onAreaChange={setSelectedArea} />
              </div>
              
              {/* ‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£ */}
              <div className="h-full">
                <ServiceTypeFilter ref={serviceTypeFilterRef} selectedServiceTypes={selectedServiceTypes} onServiceTypeChange={setSelectedServiceTypes} />
              </div>
              
              {/* ‡∏ä‡πà‡∏ß‡∏á‡πÄ‡∏ß‡∏•‡∏≤ */}
              <div className="h-full">
                <Card className="h-full">
                  <CardHeader className="pb-3">
                    <CardTitle className="text-base">‡∏ä‡πà‡∏ß‡∏á‡πÄ‡∏ß‡∏•‡∏≤</CardTitle>
                  </CardHeader>
                  <CardContent>
                    <TimeFilter ref={timeFilterRef} value={timeFilter} onChange={setTimeFilter} />
                  </CardContent>
                </Card>
              </div>
              
              {/* ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Ñ‡∏¥‡∏î‡πÄ‡∏´‡πá‡∏ô */}
              <div className="h-full">
                <Card className="h-full">
                  <CardHeader className="pb-3">
                    <CardTitle className="text-base">‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Ñ‡∏¥‡∏î‡πÄ‡∏´‡πá‡∏ô</CardTitle>
                  </CardHeader>
                  <CardContent>
                    <CategoryFilter ref={categoryFilterRef} selectedCategories={selectedCategories} onCategoryChange={setSelectedCategories} />
                  </CardContent>
                </Card>
              </div>
            </div>
          </CardContent>
        </Card>

        {/* ‡∏ó‡∏±‡∏®‡∏ô‡∏Ñ‡∏ï‡∏¥‡∏£‡∏≤‡∏¢‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà Container */}
        <Card>
          <CardHeader>
            <CardTitle className="text-lg flex items-center gap-3">
              <span className="text-2xl">üìä</span>
              ‡∏ó‡∏±‡∏®‡∏ô‡∏Ñ‡∏ï‡∏¥‡∏£‡∏≤‡∏¢‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà
            </CardTitle>
          </CardHeader>
          <CardContent>
            <RegionalSentimentChart selectedArea={selectedArea} />
          </CardContent>
        </Card>

        {/* ‡πÅ‡∏ô‡∏ß‡πÇ‡∏ô‡πâ‡∏°‡∏ó‡∏±‡∏®‡∏ô‡∏Ñ‡∏ï‡∏¥ Container */}
        <Card>
          <CardHeader>
            <CardTitle className="text-lg flex items-center gap-3">
              <span className="text-2xl">üìà</span>
              ‡πÅ‡∏ô‡∏ß‡πÇ‡∏ô‡πâ‡∏°‡∏ó‡∏±‡∏®‡∏ô‡∏Ñ‡∏ï‡∏¥
            </CardTitle>
          </CardHeader>
          <CardContent>
            <SentimentTrendsChart />
          </CardContent>
        </Card>

        {/* ‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å‡∏Å‡∏•‡πà‡∏≤‡∏ß‡∏ñ‡∏∂‡∏á Container */}
        <MentionedCategoriesTable />
      </div>
    </div>;
}